# SecureGist Backend

A robust, asynchronous FastAPI backend for SecureGist, designed to store encrypted code snippets securely. It uses PostgreSQL for persistence and implements expiration and access limit logic.

## ğŸš€ Features

- **Encrypted Storage**: Stores only encrypted blobs (UUID, BYTEA, JSONB). The backend never sees plaintext.
- **Access Control**: Supports "burn after reading" (max reads) and time-based expiration.
- **High Performance**: Built with `FastAPI`, `SQLAlchemy` (async), and `asyncpg`.
- **Production Ready**: structured in a `src` package layout with comprehensive testing.
- **Modern Tooling**: Uses `uv` for fast dependency management.

## ğŸ›  Prerequisites

- **Python**: 3.14+
- **Package Manager**: [uv](https://github.com/astral-sh/uv) (recommended) or pip.
- **Database**: PostgreSQL 16+

## ğŸ“¦ Installation

1. **Clone the repository**:

    ```bash
    git clone https://github.com/Derad6709/SecureGist
    cd securegist/backend
    ```

2. **Configure Environment**:
    Copy the example environment file and update it with your database credentials.

    ```bash
    cp .env.example .env
    ```

    *Ensure `DATABASE_URL` in `.env` points to your running PostgreSQL instance.*

3. **Install Dependencies**:
    Using `uv` (faster, recommended):

    ```bash
    uv sync
    ```

## ğŸ—„ï¸ Database Setup

The application automatically creates the necessary database tables on startup using SQLAlchemy's metadata. Ensure your PostgreSQL server is running and the database defined in `DATABASE_URL` exists.

If using Docker:

```bash
docker-compose up -d db
```

## â–¶ï¸ Running the Server

Start the development server with auto-reload:

Using `uv`:

```bash
uv run uvicorn src.main:app --reload
```

Using standard python/pip:

The API will be available at `http://localhost:8000`.

## ğŸ§ª Testing

### Automated Tests

This project uses `pytest` for unit and integration testing. Tests cover schemas, API endpoints, read limits, and expiration logic.

Run tests using `uv`:

```bash
uv run pytest
```

### Manual Testing (Postman)

A Postman collection is included for interactive testing.

1. Open Postman.
2. Import `securegist.postman_collection.json`.
3. Run the requests. The collection includes scripts to automatically handle variables (like `gist_id`).
    - **Create Gist**: Creates a standard gist.
    - **Create Gist (Max Reads=1)**: Creates a gist that can be read only once.
    - **Get Gist**: Retrieves the gist (increments counter).
    - **Get Gist (Limited)**: Verify access limits.
    - **Delete Gist**: Manually remove a gist.

## ğŸ“š API Documentation

Interactive API documentation is automatically generated by FastAPI:

- **Swagger UI**: [http://localhost:8000/docs](http://localhost:8000/docs)
- **ReDoc**: [http://localhost:8000/redoc](http://localhost:8000/redoc)

## ğŸ“‚ Project Structure

```text
backend/
â”œâ”€â”€ src/                # Application source code
â”‚   â”œâ”€â”€ api.py          # API endpoints
â”‚   â”œâ”€â”€ crud.py         # Database operations
â”‚   â”œâ”€â”€ db.py           # Database connection setup
â”‚   â”œâ”€â”€ dependencies.py # Dependency injection (get_db)
â”‚   â”œâ”€â”€ main.py         # App entry point & lifespan
â”‚   â”œâ”€â”€ models.py       # SQLAlchemy ORM models
â”‚   â””â”€â”€ schemas.py      # Pydantic schemas
â”œâ”€â”€ tests/              # Test suite
â”‚   â”œâ”€â”€ conftest.py     # Pytest configuration & fixtures
â”‚   â”œâ”€â”€ test_api.py     # Integration tests
â”‚   â””â”€â”€ test_schemas.py # Unit tests
â”œâ”€â”€ .env                # Environment variables (not committed)
â”œâ”€â”€ docker-compose.yml  # Docker config for DB
â”œâ”€â”€ pyproject.toml      # Project configuration (uv)
â””â”€â”€ securegist.postman_collection.json # Postman tests
```
